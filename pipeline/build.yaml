trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

variables:
  versionNumber: '$(Build.BuildNumber)'

steps:
  - script: |
      set -ex
      
      env

      pushd buildAndReleaseTask
        npm install
        npm run test
      popd

      sudo npm install tfx-cli@0.7.11

      tfx extension publish \
        --no-prompt \
        --manifest-globs vss-extension.json \
        --override "{ \"version\": \"1.0.${versionNumber}\" }" \
        --share-with codexarcana \
        --token $(PAT)